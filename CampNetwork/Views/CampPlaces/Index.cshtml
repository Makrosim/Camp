@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h1>Ваши места отдыха</h1>
<div>
    <a href="/CampPlaces/AddCampPlace">Добавить место отдыха</a>
    <a id="maplink">Показать карту</a>
</div>

<div id="map"></div>

<div>

    @{if (ViewBag.CP != null)
        {
            foreach (var cp in ViewBag.CP)
            {
                <div class="upper_list_text">@cp.Id.@cp.Name</div>
                <div class="upper_list_text">Координаты: @cp.LocationX, @cp.LocationY</div>
                <div class="upper_list_text">Чистота: @cp.Purity</div>
                <div>Людность: @cp.Crowdy</div>
                <div>Доступность: @cp.Appriachibility</div>
                <div>Комфорт: @cp.Comfortableness</div>
                <div class="lower_list_text">@cp.ShortDescription</div>
                <div>Обзоров: @{if(cp.Articles == null)
                                {
                                    <span>0</span>
                                }
                                else
                                {
                                    <span>@cp.Articles.Count</span>
                                }
                               }
                     <a href="/Article/Index/@cp.Id">Добавить обзор</a> <a class="left_buttons" href="/CampPlaces/Delete/@cp.Id">Удалить место отдыха</a>
                </div>
            }
        }
    }
    
</div>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBiYT8YJ36AWUsSXozMhCOWi-ruz0tgPc&callback=initMap"></script>

<script type="text/javascript">

    var opened = false;

    var link = document.getElementById("maplink");
    var divmap = document.getElementById("map");
    var map;

    link.onclick = function ()
    {
        if(opened)
        {
            delete map;
            divmap.style.height = 0 + "px";
            opened = false;
        }
        else
        {
            divmap.style.height = 500 + "px";
            initMap();
            opened = true;
        }
    }

    function initMap()
    {
        var myLatlng = { lat: 50, lng: 36.28 };
        var camps = @Html.Raw(Json.Encode(ViewBag.Points));

        map = new google.maps.Map(document.getElementById('map'), { center: myLatlng, zoom: 8 });

        camps.forEach(function (item, i, camps)
        {
            var point = item.split(" ");
            var marker = new google.maps.Marker({
                position: { lat: parseFloat(point[1]), lng: parseFloat(point[0]) },
                map: map,
                title: point[2]
            });
        });

    }
</script>

